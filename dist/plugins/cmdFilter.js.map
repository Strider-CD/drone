{"version":3,"sources":["../../lib/plugins/cmdFilter.js"],"names":[],"mappings":";;AAAA,IAAI,SAAS,QAAQ,aAAR,EAAuB,MAAvB,CAAb;AACA,QAAQ,gBAAR;;AAEA,OAAO,OAAP,GAAiB,UAAU,OAAV,EAAmB,MAAnB,EAA2B;AAC1C,sBAAoB,OAApB;AACA,UAAQ,EAAR,CAAW,qCAAX,EAAkD,SAAlD;;AAEA,WAAS,SAAT,CAAoB,GAApB,EAAyB,EAAzB,EAA6B;AAC3B,QAAI,CAAC,IAAI,WAAJ,CAAgB,cAAhB,CAA+B,MAA/B,CAAL,EAA6C;AAC3C,SAAG,IAAH,EAAS,GAAT,EAD2C,CAC7B;AACd;AACD;;AAED,QAAI,IAAI,WAAJ,CAAgB,cAAhB,CAA+B,MAA/B,CAAJ,EAA4C;AAC1C;AACA,UAAI,UAAU,UAAd;AACA,UAAI,WAAJ,CAAgB,IAAhB,GAAuB,IAAI,WAAJ,CAAgB,IAAhB,CAAqB,MAArB,CAA4B,UAAU,IAAV,EAAgB;AACjE,YAAI,QAAQ,IAAR,CAAa,IAAb,MAAuB,IAA3B,EAAiC;AAC/B,iBAAO,IAAP;AACD,SAFD,MAEO;AACL,iBAAO,KAAP;AACD,SALgE,CAKhE;AACF,OANsB,CAAvB;AAOD;AACD,OAAG,IAAH,EAAS,GAAT;AACD;AACF,CAvBD;;AAyBA,SAAS,mBAAT,CAA8B,OAA9B,EAAuC;AACrC,UAAQ,IAAR,CAAa,kCAAb,EACE,SADF,EAEE,qCAFF,EAGE,GAHF,EAIE,UAAU,GAAV,EAAe,GAAf,EAAoB;AAClB,WAAO,KAAP,CAAa,6BAAb,EAA4C,GAA5C;AACD,GANH;AAOD","file":"cmdFilter.js","sourcesContent":["var logger = require('../util/log')(module)\nrequire('shelljs/global')\n\nmodule.exports = function (emitter, client) {\n  installIntoWorkflow(emitter)\n  emitter.on('workflow.registeredEvent.cmd.filter', cmdFilter)\n\n  function cmdFilter (job, cb) {\n    if (!job.triggerInfo.hasOwnProperty('cmds')) {\n      cb(null, job) // nothing to do here\n      return\n    }\n\n    if (job.triggerInfo.hasOwnProperty('cmds')) {\n      // TODO: patterns should reside in a config file\n      var pattern = /\\bsudo\\b/\n      job.triggerInfo.cmds = job.triggerInfo.cmds.filter(function (elem) {\n        if (pattern.exec(elem) === null) {\n          return true\n        } else {\n          return false\n        }// discard command if one of the regexps matches\n      })\n    }\n    cb(null, job)\n  }\n}\n\nfunction installIntoWorkflow (emitter) {\n  emitter.emit('workflow.registeredEvent.install',\n    'job.new',\n    'workflow.registeredEvent.cmd.filter',\n    300,\n    function (err, res) {\n      logger.debug('installIntoWorkflow failed!', err)\n    })\n}\n"]}